---
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: SecurityPolicy
metadata:
  name: ${APP}-auth
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: ${APP}
  oidc:
    provider:
      issuer: https://login.chillincool.net/realms/chillincool
    clientID: ${OIDC_CLIENT_ID}
    clientSecret:
      name: ${APP}-oidc-secret
    redirectURL: https://${OIDC_REDIRECT_HOST}/oauth2/callback
    forwardAccessToken: true
  jwt:
    providers:
      - name: keycloak
        issuer: https://login.chillincool.net/realms/chillincool
        remoteJWKS:
          uri: https://login.chillincool.net/realms/chillincool/protocol/openid-connect/certs
        claimToHeaders:
          - claim: preferred_username
            header: Remote-User

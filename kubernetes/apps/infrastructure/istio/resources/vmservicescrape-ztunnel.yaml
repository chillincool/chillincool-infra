---
# VMPodScrape for Istio Ambient ztunnel metrics
# ztunnel is a DaemonSet that provides L4 traffic metrics in Ambient mode
# Provides istio_tcp_*, istio_requests_total (for HBONE), connection metrics
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMPodScrape
metadata:
  name: ztunnel
  namespace: istio-system
spec:
  selector:
    matchLabels:
      app: ztunnel
  podMetricsEndpoints:
    - port: ztunnel-stats
      path: /stats/prometheus
      interval: 15s
      relabelConfigs:
        - sourceLabels: [__meta_kubernetes_pod_name]
          targetLabel: pod_name
        - sourceLabels: [__meta_kubernetes_namespace]
          targetLabel: namespace
        - sourceLabels: [__meta_kubernetes_pod_node_name]
          targetLabel: node

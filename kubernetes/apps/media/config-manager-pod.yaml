---
apiVersion: v1
kind: Pod
metadata:
  name: config-manager
  namespace: media
spec:
  securityContext:
    fsGroup: 568
  initContainers:
    - name: fix-permissions
      image: alpine:latest
      command:
        - sh
        - -c
        - |
          chown -R 568:568 /storage/config /storage/backups
          chmod -R 775 /storage/config
          chmod -R 775 /storage/backups
      volumeMounts:
        - name: config
          mountPath: /storage/config
        - name: backups
          mountPath: /storage/backups
        - name: dsm1
          mountPath: /storage/dsm1
  containers:
    - name: manager
      image: alpine:latest
      command: ["sleep", "infinity"]
      securityContext:
        runAsUser: 568
        runAsGroup: 568
      volumeMounts:
        - name: config
          mountPath: /storage/config
        - name: backups
          mountPath: /storage/backups
        - name: dsm1
          mountPath: /storage/dsm1
        - name: realdebrid
          mountPath: /storage/realdebrid
  volumes:
    - name: config
      persistentVolumeClaim:
        claimName: config
    - name: backups
      persistentVolumeClaim:
        claimName: backups
    - name: dsm1
      persistentVolumeClaim:
        claimName: dsm1-data
    - name: realdebrid
      persistentVolumeClaim:
        claimName: realdebrid-webdav

---
# One-time Job to create directory structure on symlinks PVC
# This runs once and ensures all required directories exist
apiVersion: batch/v1
kind: Job
metadata:
  name: symlinks-setup
  namespace: media
spec:
  ttlSecondsAfterFinished: 3600
  template:
    spec:
      restartPolicy: OnFailure
      containers:
        - name: setup
          image: alpine:latest
          command:
            - sh
            - -c
            - |
              echo "Creating symlinks directory structure..."
              mkdir -p /storage/symlinks/downloads/sonarr
              mkdir -p /storage/symlinks/downloads/radarr
              mkdir -p /storage/symlinks/movies
              mkdir -p /storage/symlinks/series
              
              echo "Setting ownership to 568:568..."
              chown -R 568:568 /storage/symlinks
              
              echo "Directory structure created:"
              ls -la /storage/symlinks/
              ls -la /storage/symlinks/downloads/
              
              echo "Setup complete!"
          volumeMounts:
            - name: symlinks
              mountPath: /storage/symlinks
          resources:
            requests:
              cpu: 10m
              memory: 16Mi
            limits:
              cpu: 50m
              memory: 32Mi
      volumes:
        - name: symlinks
          persistentVolumeClaim:
            claimName: symlinks

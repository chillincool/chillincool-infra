---
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: SecurityPolicy
metadata:
  name: navidrome-auth
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: navidrome
  oidc:
    provider:
      issuer: https://login.chillincool.net/realms/chillincool
    clientID: navidrome
    clientSecret:
      name: navidrome-oidc-secret
    redirectURL: https://navidrome.chillincool.net/oauth2/callback
    forwardAccessToken: true
  jwt:
    providers:
      - name: keycloak
        issuer: https://login.chillincool.net/realms/chillincool
        remoteJWKS:
          uri: https://login.chillincool.net/realms/chillincool/protocol/openid-connect/certs
        claimToHeaders:
          - claim: preferred_username
            header: Remote-User

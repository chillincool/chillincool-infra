---
# TALOS NODE-SPECIFIC CONFIGURATION: k8s-1
# 
# This file overrides and patches the base machineconfig.yaml.j2 for the second control plane node.
# Node-specific settings:
# - Hostname: k8s-1
# - Thunderbolt network interface configuration
# - Point-to-point networking for inter-node communication
#
# CUSTOMIZATION NOTES:
# - Different IP addresses than k8s-0 and k8s-2
# - Multiple point-to-point connections for redundancy and etcd clustering
# - Zone label helps Kubernetes spread pods across physical machines

version: v1alpha1
kind: Config

machine:
  # Hostname for this specific node
  # k8s-1 = second control plane
  hostname: k8s-1
  
  # NETWORK CUSTOMIZATION FOR THIS NODE
  # Extends the bond0 configuration from machineconfig.yaml.j2
  network:
    interfaces:
      # Point-to-point Thunderbolt connection to k8s-0
      # .21 is the next sequential IP from k8s-0's .20
      - interface: tbt0
        addresses:
          - address: 169.254.255.21/32
        routes:
          # Reach k8s-0 directly
          - destination: 169.254.255.20/32
            gateway: 169.254.255.20
          # Reach k8s-2 (may route through k8s-0 if needed)
          - destination: 169.254.255.22/32
            gateway: 169.254.255.20
      
      # Point-to-point Thunderbolt connection to k8s-2
      # Using different subnet (169.254.254.x) for redundancy
      - interface: tbt1
        addresses:
          - address: 169.254.254.21/32
        routes:
          # Reach k8s-0 through secondary link
          - destination: 169.254.254.20/32
            gateway: 169.254.254.20
          # Reach k8s-2 directly
          - destination: 169.254.254.22/32
            gateway: 169.254.254.22

  # Kubernetes node labels for this specific node
  nodeLabels:
    # Zone label: Primary zone (for pod anti-affinity)
    topology.kubernetes.io/zone: zone-1
    # Control plane index
    talos.dev/cluster-node-index: "1"

# Control plane specific settings (IS_CONTROLLER=true for k8s-1)
cluster:
  # etcd: Tell other nodes about this node's etcd endpoint
  etcd:
    # Subdomain for this specific etcd member
    peerSubdomainName: "k8s-1"
